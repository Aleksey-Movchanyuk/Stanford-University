define("bundles/discussions/components/sessionFilter/SessionFilterDropdown",["require","exports","module","underscore","react","moment","classnames","react-bootstrap","js/lib/coursera.react-intl","vendor/cnpm/fluxible.v0-4/addons/connectToStores","js/lib/waitFor","i18n!nls/discussions","css!bundles/discussions/components/sessionFilter/__styles__/SessionFilterDropdown"],function(require,exports,module){"use strict";function _defaults(e,s){for(var i=Object.getOwnPropertyNames(s),t=0;t<i.length;t++){var r=i[t],n=Object.getOwnPropertyDescriptor(s,r);n&&n.configurable&&void 0===e[r]&&Object.defineProperty(e,r,n)}return e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var s,i,_=require("underscore"),e=require("react"),t=require("moment"),a=require("classnames"),n=require("react-bootstrap"),d=n.DropdownButton,r=n.MenuItem,c=require("js/lib/coursera.react-intl"),u=c.FormattedMessage,p=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),f=require("js/lib/waitFor"),o="MMM DD, YYYY",l=require("i18n!nls/discussions");require("css!bundles/discussions/components/sessionFilter/__styles__/SessionFilterDropdown");var b=(i=s=function(n){function SessionFilterDropdown(i,o){_classCallCheck(this,SessionFilterDropdown);var s=_possibleConstructorReturn(this,n.call(this,i,o));if(s.handleDropdownChange=function(e){var t=void 0,r=void 0,n=void 0;e.startsWith("all~")?(t=s.props.branches.find(function(t){return t.id===e.substring(4,e.length)}),r=t.filters.find(function(e){return"all"===e.id}),n="all"):(t=s.props.branches.find(function(t){return!!t.filters.find(function(t){return t.id===e})}),r=t.filters.find(function(t){return t.id===e}),n=e),s.setState({selectedFilter:r}),s.props.handleDropdownChange(n,t.id)},s.buildBranchMenuItemDisplay=function(t){return e.createElement(r,{key:t.id,eventKey:t.id,disabled:!0,className:"disabled"},e.createElement("div",{className:"horizontal-box"},t.label))},s.buildAllBranchFilterMenuItemDisplay=function(t){return t.filters.map(function(t){if(s.props.hideAllSessionsOption&&"all"===t.id)return null;var n="all"!==t.id?t.id:"all~"+t.branchId,i=a({"body-2-text":t.id===s.state.selectedFilter.id&&t.branchId===s.state.selectedFilter.branchId});return e.createElement(r,{key:n,eventKey:n},e.createElement("div",{className:i},s.buildFilterMenuItemDisplay(t,!0)))})},s.buildFilterMenuItemDisplay=function(r,n){if("ondemand"===r.id||"all"===r.id)return e.createElement("div",{className:"horizontal-box menu-item-box"},n&&e.createElement("span",null," - "),s.buildFilterDisplayString(r,n),"ondemand"===r.id&&n&&e.createElement("div",{className:"menu-item-label caption-text color-secondary-text"},l("Active")));var i=s.props.allSessions.find(function(e){return e.id===r.id}),o=_(i.moduleDeadlines).chain().sortBy(function(e){return e.startedAt}).find(function(e){return t(e.deadline).isAfter(t())}).value(),a=o&&t(o).diff(t(i.startedAt),"weeks")+1;return e.createElement("div",{className:"horizontal-box menu-item-box"},n&&e.createElement("span",null," - "),s.buildFilterDisplayString(r,n),n&&a>0&&t(i.endedAt).isAfter(t())&&e.createElement("div",{className:"menu-item-label caption-text color-secondary-text"},e.createElement(u,{message:l("Week {weekNumber} assignment due"),weekNumber:a})))},i.hideAllSessionsOption&&"all"===i.selectedFilter.id){var d=i.branches.find(function(e){return e.id===i.currentBranchId})||i.branches[0];s.state={selectedFilter:d.filters.find(function(e){return"all"!==e.id})},i.handleDropdownChange(s.state.selectedFilter.id)}else s.state={selectedFilter:i.selectedFilter};return s}return _inherits(SessionFilterDropdown,n),SessionFilterDropdown.prototype.buildFilterDisplayString=function buildFilterDisplayString(e,n){var r=this.props.branches.find(function(t){return t.id===e.branchId});if("ondemand"===e.id)return n?"Self Paced":"Self Paced ("+r.label+")";if("all"===e.id)return"All sessions for "+r.label;var i=t(e.startedAt).format(o),l=t(e.endedAt).format(o),s=i+" - "+l;return n?s:s+(" ("+r.label+")")},SessionFilterDropdown.prototype.render=function render(){var t=this;if(!this.props.branches||0===this.props.branches.length)return null;var n=this.props.limitSwitchingToCurrentBranch?this.props.branches.filter(function(e){return e.id===t.props.currentBranchId}):this.props.branches;return e.createElement("div",{className:"rc-SessionFilterDropdown body-1-text"},e.createElement("div",{className:"dropdown-section"},e.createElement(d,{id:this.props.id,title:this.buildFilterMenuItemDisplay(this.state.selectedFilter,!1),onSelect:this.handleDropdownChange},n.map(function(s,i){return[n.length>1?t.buildBranchMenuItemDisplay(s):null].concat(_toConsumableArray(t.buildAllBranchFilterMenuItemDisplay(s)),[i===n.length-1?null:e.createElement(r,{className:"disabled",disabled:!0,key:s.id+"spacer"}," ")])}))))},SessionFilterDropdown}(e.Component),s.propTypes={handleDropdownChange:e.PropTypes.func.isRequired,id:e.PropTypes.string,branches:e.PropTypes.arrayOf(e.PropTypes.shape({id:e.PropTypes.string,label:e.PropTypes.string,filters:e.PropTypes.arrayOf(e.PropTypes.shape({branchId:e.PropTypes.string.isRequired,startedAt:e.PropTypes.number,endedAt:e.PropTypes.number}))})),allSessions:e.PropTypes.array,selectedFilter:e.PropTypes.shape({id:e.PropTypes.string.isRequired,startedAt:e.PropTypes.number,endedAt:e.PropTypes.number}),hideAllSessionsOption:e.PropTypes.bool,limitSwitchingToCurrentBranch:e.PropTypes.bool,currentBranchId:e.PropTypes.string},i);module.exports=_.compose(p(["SessionFilterStore"],function(t,r){var e=t.SessionFilterStore;return{branches:e.branches,sessionsLoaded:e.filtersLoaded,selectedFilter:e.activeFilter,allSessions:e.allSessions,currentBranchId:e.currentBranchId}}),f(function(e){return e.sessionsLoaded}))(b)});